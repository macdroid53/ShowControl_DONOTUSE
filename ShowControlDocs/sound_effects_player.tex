% This file was converted to LaTeX by Writer2LaTeX ver. 1.0.2
% see http://writer2latex.sourceforge.net for more info
\documentclass[letterpaper]{article}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[english]{babel}
\usepackage{amsmath}
\usepackage{amssymb,amsfonts,textcomp}
\usepackage{color}
\usepackage{array}
\usepackage{hhline}
\usepackage{hyperref}
\hypersetup{pdftex, colorlinks=true, linkcolor=blue, citecolor=blue, filecolor=blue, urlcolor=blue, pdftitle=, pdfauthor=John Sauter, pdfsubject=, pdfkeywords=}
\newcommand\textsubscript[1]{\ensuremath{{}_{\text{#1}}}}
% Outline numbering
\setcounter{secnumdepth}{0}
% List styles
\newcommand\liststyleLv{%
\renewcommand\theenumi{\arabic{enumi}}
\renewcommand\theenumii{\arabic{enumii}}
\renewcommand\theenumiii{\arabic{enumiii}}
\renewcommand\theenumiv{\arabic{enumiv}}
\renewcommand\labelenumi{\theenumi.}
\renewcommand\labelenumii{\theenumii.}
\renewcommand\labelenumiii{\theenumiii.}
\renewcommand\labelenumiv{\theenumiv.}
}
\newcommand\liststyleLvi{%
\renewcommand\labelitemi{•}
\renewcommand\labelitemii{◦}
\renewcommand\labelitemiii{${\blacksquare}$}
\renewcommand\labelitemiv{•}
}
\newcommand\liststyleLvii{%
\renewcommand\labelitemi{•}
\renewcommand\labelitemii{◦}
\renewcommand\labelitemiii{${\blacksquare}$}
\renewcommand\labelitemiv{•}
}
\newcommand\liststyleLviii{%
\renewcommand\labelitemi{•}
\renewcommand\labelitemii{◦}
\renewcommand\labelitemiii{${\blacksquare}$}
\renewcommand\labelitemiv{•}
}
\newcommand\liststyleLix{%
\renewcommand\labelitemi{•}
\renewcommand\labelitemii{◦}
\renewcommand\labelitemiii{${\blacksquare}$}
\renewcommand\labelitemiv{•}
}
\newcommand\liststyleLx{%
\renewcommand\theenumi{\arabic{enumi}}
\renewcommand\theenumii{\alph{enumii}}
\renewcommand\labelenumi{ \theenumi.}
\renewcommand\labelenumii{ \theenumii)}
\renewcommand\labelitemi{•}
\renewcommand\labelitemii{•}
}
\newcommand\liststyleLxi{%
\renewcommand\theenumi{\arabic{enumi}}
\renewcommand\theenumii{\alph{enumii}}
\renewcommand\labelenumi{ \theenumi.}
\renewcommand\labelenumii{ \theenumii)}
\renewcommand\labelitemi{•}
\renewcommand\labelitemii{•}
}
\newcommand\liststyleLxii{%
\renewcommand\theenumi{\arabic{enumi}}
\renewcommand\theenumii{\alph{enumii}}
\renewcommand\labelenumi{ \theenumi.}
\renewcommand\labelenumii{ \theenumii)}
\renewcommand\labelitemi{•}
\renewcommand\labelitemii{•}
}
\newcommand\liststyleLxiii{%
\renewcommand\theenumi{\arabic{enumi}}
\renewcommand\theenumii{\alph{enumii}}
\renewcommand\labelenumi{ \theenumi.}
\renewcommand\labelenumii{ \theenumii)}
\renewcommand\labelitemi{•}
\renewcommand\labelitemii{•}
}
\newcommand\liststyleLxiv{%
\renewcommand\labelitemi{•}
\renewcommand\labelitemii{◦}
\renewcommand\labelitemiii{${\blacksquare}$}
\renewcommand\labelitemiv{•}
}
\newcommand\liststyleLxv{%
\renewcommand\theenumi{\arabic{enumi}}
\renewcommand\theenumii{\alph{enumii}}
\renewcommand\labelenumi{ \theenumi.}
\renewcommand\labelenumii{ \theenumii)}
\renewcommand\labelitemi{•}
\renewcommand\labelitemii{•}
}
\newcommand\liststyleLxvi{%
\renewcommand\theenumi{\arabic{enumi}}
\renewcommand\theenumii{\arabic{enumii}}
\renewcommand\theenumiii{\arabic{enumiii}}
\renewcommand\theenumiv{\arabic{enumiv}}
\renewcommand\labelenumi{\theenumi.}
\renewcommand\labelenumii{\theenumii.}
\renewcommand\labelenumiii{\theenumiii.}
\renewcommand\labelenumiv{\theenumiv.}
}
\newcommand\liststyleLxvii{%
\renewcommand\theenumi{\arabic{enumi}}
\renewcommand\theenumii{\arabic{enumii}}
\renewcommand\theenumiii{\arabic{enumiii}}
\renewcommand\theenumiv{\arabic{enumiv}}
\renewcommand\labelenumi{\theenumi.}
\renewcommand\labelenumii{\theenumii.}
\renewcommand\labelenumiii{\theenumiii.}
\renewcommand\labelenumiv{\theenumiv.}
}
\newcommand\liststyleLxviii{%
\renewcommand\theenumi{\arabic{enumi}}
\renewcommand\theenumii{\arabic{enumii}}
\renewcommand\theenumiii{\arabic{enumiii}}
\renewcommand\theenumiv{\arabic{enumiv}}
\renewcommand\labelenumi{\theenumi.}
\renewcommand\labelenumii{\theenumii.}
\renewcommand\labelenumiii{\theenumiii.}
\renewcommand\labelenumiv{\theenumiv.}
}
\newcommand\liststyleLxix{%
\renewcommand\theenumi{\arabic{enumi}}
\renewcommand\theenumii{\arabic{enumii}}
\renewcommand\theenumiii{\arabic{enumiii}}
\renewcommand\theenumiv{\arabic{enumiv}}
\renewcommand\labelenumi{\theenumi.}
\renewcommand\labelenumii{\theenumii.}
\renewcommand\labelenumiii{\theenumiii.}
\renewcommand\labelenumiv{\theenumiv.}
}
\newcommand\liststyleLxx{%
\renewcommand\theenumi{\arabic{enumi}}
\renewcommand\theenumii{\arabic{enumii}}
\renewcommand\theenumiii{\arabic{enumiii}}
\renewcommand\theenumiv{\arabic{enumiv}}
\renewcommand\labelenumi{\theenumi.}
\renewcommand\labelenumii{\theenumii.}
\renewcommand\labelenumiii{\theenumiii.}
\renewcommand\labelenumiv{\theenumiv.}
}
\newcommand\liststyleLxxi{%
\renewcommand\theenumi{\arabic{enumi}}
\renewcommand\theenumii{\arabic{enumii}}
\renewcommand\theenumiii{\arabic{enumiii}}
\renewcommand\theenumiv{\arabic{enumiv}}
\renewcommand\labelenumi{\theenumi.}
\renewcommand\labelenumii{\theenumii.}
\renewcommand\labelenumiii{\theenumiii.}
\renewcommand\labelenumiv{\theenumiv.}
}
\newcommand\liststyleLxxii{%
\renewcommand\theenumi{\arabic{enumi}}
\renewcommand\theenumii{\arabic{enumii}}
\renewcommand\theenumiii{\arabic{enumiii}}
\renewcommand\theenumiv{\arabic{enumiv}}
\renewcommand\labelenumi{\theenumi.}
\renewcommand\labelenumii{\theenumii.}
\renewcommand\labelenumiii{\theenumiii.}
\renewcommand\labelenumiv{\theenumiv.}
}
\newcommand\liststyleLxxiii{%
\renewcommand\theenumi{\arabic{enumi}}
\renewcommand\theenumii{\arabic{enumii}}
\renewcommand\theenumiii{\arabic{enumiii}}
\renewcommand\theenumiv{\arabic{enumiv}}
\renewcommand\labelenumi{\theenumi.}
\renewcommand\labelenumii{\theenumii.}
\renewcommand\labelenumiii{\theenumiii.}
\renewcommand\labelenumiv{\theenumiv.}
}
\newcommand\liststyleLxxiv{%
\renewcommand\theenumi{\arabic{enumi}}
\renewcommand\theenumii{\arabic{enumii}}
\renewcommand\theenumiii{\arabic{enumiii}}
\renewcommand\theenumiv{\arabic{enumiv}}
\renewcommand\labelenumi{\theenumi.}
\renewcommand\labelenumii{\theenumii.}
\renewcommand\labelenumiii{\theenumiii.}
\renewcommand\labelenumiv{\theenumiv.}
}
\newcommand\liststyleLxxv{%
\renewcommand\theenumi{\arabic{enumi}}
\renewcommand\theenumii{\arabic{enumii}}
\renewcommand\theenumiii{\arabic{enumiii}}
\renewcommand\theenumiv{\arabic{enumiv}}
\renewcommand\labelenumi{\theenumi.}
\renewcommand\labelenumii{\theenumii.}
\renewcommand\labelenumiii{\theenumiii.}
\renewcommand\labelenumiv{\theenumiv.}
}
\newcommand\liststyleLxxvi{%
\renewcommand\theenumi{\arabic{enumi}}
\renewcommand\theenumii{\arabic{enumii}}
\renewcommand\theenumiii{\arabic{enumiii}}
\renewcommand\theenumiv{\arabic{enumiv}}
\renewcommand\labelenumi{\theenumi.}
\renewcommand\labelenumii{\theenumii.}
\renewcommand\labelenumiii{\theenumiii.}
\renewcommand\labelenumiv{\theenumiv.}
}
\newcommand\liststyleLxxvii{%
\renewcommand\theenumi{\arabic{enumi}}
\renewcommand\theenumii{\arabic{enumii}}
\renewcommand\theenumiii{\arabic{enumiii}}
\renewcommand\theenumiv{\arabic{enumiv}}
\renewcommand\labelenumi{\theenumi.}
\renewcommand\labelenumii{\theenumii.}
\renewcommand\labelenumiii{\theenumiii.}
\renewcommand\labelenumiv{\theenumiv.}
}
% Page layout (geometry)
\setlength\voffset{-1in}
\setlength\hoffset{-1in}
\setlength\topmargin{0.7874in}
\setlength\oddsidemargin{0.7874in}
\setlength\textheight{8.698866in}
\setlength\textwidth{6.9251995in}
\setlength\footskip{26.148pt}
\setlength\headheight{12pt}
\setlength\headsep{0.1965in}
% Footnote rule
\setlength{\skip\footins}{0.0469in}
\renewcommand\footnoterule{\vspace*{-0.0071in}\setlength\leftskip{0pt}\setlength\rightskip{0pt plus 1fil}\noindent\textcolor{black}{\rule{0.25\columnwidth}{0.0071in}}\vspace*{0.0398in}}
% Pages styles
\makeatletter
\newcommand\ps@Standard{
  \renewcommand\@oddhead{My Ideal Sound Effects Player\hfill \hfill December 21, 2014}
  \renewcommand\@evenhead{\@oddhead}
  \renewcommand\@oddfoot{\hfill Page \thepage{} of ?}
  \renewcommand\@evenfoot{\@oddfoot}
  \renewcommand\thepage{\arabic{page}}
}
\makeatother
\pagestyle{Standard}
\newcounter{Drawing}
\renewcommand\theDrawing{\arabic{Drawing}}
\title{}
\author{John Sauter}
\date{2014-12-21T04:50:43.502510496}
\begin{document}
\section{My Ideal Sound Effects Player}
\subsection{Roles}
There are three people who use a sound effects player: the sound effects
designer, who creates the sounds, the sound effects operator, who plays
them at the correct time in the performance, and the sound rehearsal
operator, who plays sounds during rehearsal. \ In community theatre
these three roles are often performed by the same person. \ In
addition, if the sound effects are very simple, the stage manager can
trigger them remotely.

\subsection{Goals}
The sound effects player will

\liststyleLv
\begin{enumerate}
\item be able to make the sound of a ringing telephone,
\item be able to sequence a play as complex as The Passion of Dracula,
and as simple as Oklahoma,
\item Be able to be operated by a sound effects operator with little
previous experience, and
\item Require only a modest computer.
\end{enumerate}
In addition, one thing that has always annoyed me in a human interface
is that the meaning of a button can change just as I am about to push
it, with the result that it does something other than what I intended.
\ This design avoids that.

\subsection{Design Overview}
This design has a flexible sequencer, which is necessary for telephone
rings and The Passion of Dracula. \ The sequencer is optional, so that
a sound effects operator has a simpler interface if he is doing \ a
production with only a few sound effects that do not overlap. \ For the
simplest case, sounds can be triggered by the stage
manager{\textquotesingle}s computer using MIDI over Ethernet or OSC.

For each sound effect, the sound effects designer prepares a waveform
for each independent sound channel, the amplitude envelope, and some
additional information. \ Many community theaters have a monophonic
sound system, and so sound designs targeting such a theater will have
only a single waveform for each sound effect. \ I prefer to do sound
effects in stereo, so I always prepare two waveforms. \ I did one show
using four independent sound channels. \ This design supports up to
eight channels, since that is the maximum number of channels supported
by the gstreamer WAV file parser.

In addition, for all but the simplest shows the sound designer prepares
a collection of sequence items for the sequencer. \ I will describe the
sequencer after describing the gstreamer plug-in on which it is based,
but first I will describe the cluster.

\subsection{The Cluster}
From the point of view of the sound effects operator and sound designer,
the major item they work with is a group of controls called the
cluster. \ Whenever there is a sound that is playing, or an opportunity
to play a sound, it is linked to a cluster. \ A cluster looks something
like this:

A cluster is a 3-inch square, with text across the top, two buttons
labeled Start and Stop on the right, and a soft dial with a readout
above it on the left. \ The sound designer specifies the text displayed
across the top. \ The dial controls two variables: the
operator{\textquotesingle}s volume and the operator{\textquotesingle}s
pan. \ The sound effects operator chooses between them by pressing the
dial as though it were a button. \ The text above the dial shows either
the current volume as a number or the current pan as R number, L number
or Centered. \ The sound effects operator controls the starting and
stopping of the sound using the Start and Stop buttons.

\begin{figure}
\centering
\begin{minipage}{7in}
{\centering\itshape
[Warning: Draw object ignored][Warning: Draw object ignored][Warning:
Draw object ignored][Warning: Draw object ignored][Warning: Draw object
ignored][Warning: Draw object ignored][Warning: Draw object
ignored][Warning: Draw object ignored]Drawing
\stepcounter{Drawing}{\theDrawing}: cluster
\par}
\end{minipage}
\end{figure}
\subsection{The Gstreamer plug-in}
The sound effects player includes a gstreamer plug-in which is designed
to meet its needs. \ It is a pipeline with four filter elements: the
looper, the attack-decay-sustain part of the amplitude envelope, the
release part of the amplitude envelope, and the volume adjustment.
\ The input to the pipeline is assumed to be seekable, such as the WAV
file parser, which outputs up to eight channels. \ If a sound does not
use looping or a non-zero starting position, no seeking is done.

The amplitude envelope design is based on electronic musical
instruments. \ The ADSR envelope has four parts: attack, decay, sustain
and release. \ It is described by six numbers: 

\liststyleLvi
\begin{itemize}
\item the attack time, 
\item the attack level, 
\item the decay time, 
\item the sustain level, 
\item the release start time and 
\item the release duration time. \ 
\end{itemize}
Note that the release start time can be modified by an external action
while the sound effect is playing, so the release start time specified
by the sound designer is its initial value. \ The release duration time
can be infinite.

Internally, 

\liststyleLvii
\begin{itemize}
\item times are measured in nanoseconds, 
\item volume levels are 0.0 for silence and 1.0 for full scale, and 
\item pan values are 0 for center, -1.0 for full left and +1.0 for full
right. 
\end{itemize}
When displayed, times are shown in seconds with four decimal places, and
levels as 0 to 100\%. \ These parameters are all specified by the sound
effects designer when creating a sample. \ When the release duration
time is infinite it is shown as ${\infty}$.

An example of the ADSR envelope is the wind heard when opening a door.
\ The attack is the initial inrush of air. \ The sound then decays to
the sustain level, where it remains until the door is closed, when the
release fades the wind out.

In addition to the envelope information we have the following additional
parameters specified by the sound designer, some of which are used
elsewhere in the pipeline, or in the application:

\liststyleLviii
\begin{itemize}
\item the loop from time, 
\item the loop to time, 
\item the loop limit value, 
\item the starting position,
\item the designer{\textquotesingle}s volume level,
\item the designer{\textquotesingle}s pan value: Center, Left 1 to 100
or Right 1 to 100,
\item the name of the sound effect, and
\item the sound effect{\textquotesingle}s MIDI program number, MIDI note
number, OSC name and function key.
\end{itemize}
Other variables mentioned below are initialized when the sound effect is
triggered. \ The algorithm for computing the amplitude of each channel
of a sound effect at each time step is described here in several
stages, corresponding to the gstreamer elements. \ The algorithm is
performed independently for each channel in its source, and passes the
same number of channels to the next stage. \ 

When a sound effect is triggered, the following local variables are set:

\liststyleLix
\begin{itemize}
\item current time and the loop counter are set to 0,
\item the current position is set to the starting position,
\item The operator{\textquotesingle}s volume level is set to 100\%
(internally 1.0),
\item The operator{\textquotesingle}s pan value is set to Center
(internally 0.0),
\item the releasing condition is set to false,
\item the end of input condition is set to false,
\item the pausing condition is set to false.
\item The looping condition is set to true if the loop from time is not
equal to the loop to time; otherwise it is set to false.
\end{itemize}
\subsubsection[Looper]{Looper}
The first element in the pipeline is the looper. \ It sinks data from a
seekable source, such as the WAV file parser. \ It accepts audio/x-raw
sound samples in S16LE, S32LE, F32LE or F64LE format. \ The input value
is converted to F64LE for internal processing. \ At each time step, the
looper element does the following:

\liststyleLx
\begin{enumerate}
\item If the pausing condition is true,

\begin{enumerate}
\item Send silence (0.0) on all channels to the next stage
\item do nothing more in this stage.
\end{enumerate}
\item If the current time is equal to the release start time, the
release start time is not equal to 0, and the releasing condition is
false,

\begin{enumerate}
\item set the releasing condition to true.
\item Signal to the application that this sound effect is completed
\end{enumerate}
\item If the current position is different from the previous current
position + 1, or if this is the first time we have gotten this far in
this element and the current position is not 0, seek to the current
position in the source.
\item Take a value from each channel of the input. \ If the input
signals that it is out of data, 

\begin{enumerate}
\item set all the values to 0.0.
\item set the looping condition to false,
\item set the end of input condition to true.
\item If the releasing condition is false,

\begin{itemize}
\item set the releasing condition to true,
\item set the release start time to the current time, and
\item signal to the application that this sound effect is completed.
\end{itemize}
\end{enumerate}
\item If the current position is equal to loop from and the looping
condition is true, 

\begin{enumerate}
\item set the current position to loop to, 
\item add one to the loop counter, 
\item if the loop counter is equal to the loop limit, set the looping
condition to false,
\end{enumerate}
\item otherwise add one to the current position.
\item Add the sample interval in nanoseconds to the current time.
\item The values passed to the next stage are the values taken from the
input, or 0.0 if the input has no more data or is pausing, as described
above. \ The output format is always F64LE.
\end{enumerate}
\subsubsection{Attack, decay and sustain}
At each time step, and independently for each channel, do the following:

\liststyleLxi
\begin{enumerate}
\item If the current time is less than the attack time, multiply the
value from the previous stage by  $(\mathit{attack}\mathit{level}\ast
(\frac{\mathit{current}\mathit{time}}{\mathit{attack}\mathit{time}}))$.
\ 
\item The attack is complete when current time reaches attack time, so
if current time is greater than or equal to attack time but less than
attack time + decay time, instead multiply the value by 
$(\frac{(\mathit{attack}\mathit{time}+\mathit{decay}\mathit{time}-\mathit{current}\mathit{time})}{\mathit{decay}\mathit{time}})\ast
{\mathit{attack}\mathit{level}}$+
$(1-\frac{(\mathit{attack}\mathit{time}+\mathit{decay}\mathit{time}-\mathit{current}\mathit{time})}{\mathit{decay}\mathit{time}})\ast
{\mathit{sustain}\mathit{level}}$. \ 
\item The decay is complete when the current time reaches attack time +
decay time, so if current time is greater than or equal to attack time
+ decay time, instead multiply the value by 
$\mathit{sustain}\mathit{level}$. \ 
\item The modified values are passed on to the next stage.
\end{enumerate}
\subsubsection{Release}
At each time step, do the following:

\liststyleLxii
\begin{enumerate}
\item If the releasing condition is true, we are in the release stage of
the envelope, so do the following:

\begin{enumerate}
\item If the release duration time is infinite and the end of input
condition is true, the processing of this sound effect is complete.
\ Signal the end of the media stream and terminate.
\item If the release duration time is not infinite and the current time
is greater than or equal to release start time + release duration time,
the processing of this sound effect is complete. \ Signal the end of
the media stream and terminate.
\item If the release duration time is infinite, pass the values from the
previous stage to the next stage unmodified,
\item Otherwise multiply the values from the previous stage by
$1-\frac{\mathit{current}\mathit{time}-\mathit{release}\mathit{start}\mathit{time}}{\mathit{release}\mathit{duration}\mathit{time}}$
unless release duration time is 0, in which case pass silence (0.0) to
the next stage.
\end{enumerate}
\item If the releasing condition is not true, pass the values from the
previous stage to the next stage unmodified.
\end{enumerate}
\subsubsection[Volume and Note Velocity]{Volume and Note Velocity}
After each channel{\textquotesingle}s value has gone through envelope
processing as described above, the value is multiplied by \ 
$\mathit{designer}'s\mathit{volume}\mathit{level}\times
{\mathit{operator}'s\mathit{volume}\mathit{level}}$. \ If the sound was
triggered by a Note On MIDI event, it is further multiplied by 
$\frac{(\mathit{note}\mathit{velocity}-1.0)}{126.0}$. \ If the sound
was triggered by pressing a button on the front panel, the note
velocity is set to 127.0. \ If the sound was triggered by the internal
sequencer, the value of note velocity may be specified in the sequence
item; if it is not, and there is no Note On in its sequencer history,
the velocity is set to 127.0. \ 

After this processing is complete the values are forwarded to whatever
the application has specified for the next stage of gstreamer
processing as audio/x-raw, format F64LE or F32LE. Eventually the sound
data will reach a speaker.

The operator{\textquotesingle}s volume level and the pausing condition
are controlled by the sound effects operator during the performance.
\ The application signals changes in these variables to the pipeline.
\ 

The sound effects operator can use a function key as a convenient way to
trigger the sound, and can adjust the panning in real time.

\subsubsection{Note Off}
If the sound was triggered by a Note On MIDI event, a corresponding Note
Off initiates the release of the sound by signaling to the pipeline.
\ The release process

\liststyleLxiii
\begin{enumerate}
\item sets the release condition to true, 
\item sets the release start time to the current time and, 
\item signals to the application that this sound effect was terminated
\ 
\end{enumerate}
If the sound was triggered by pressing a start button on the front
panel, an adjacent stop button initiates the release process. \ If the
sound was triggered by the internal sequencer, there will be an item
later in the sequence which will initiate the release process, or the
sound can be stopped by the sound effects operator. \ If the sound was
triggered by a MIDI Sound Control message, a subsequent message will
initiate the release process. \ Note that for a finite source, unless a
sound loops indefinitely and has release start time of 0, it will
eventually complete even if it is never told to initiate the release
process, in which case triggering the release process is unnecessary.

\subsubsection{Defaults}
There are default values for the envelope and other data:

\liststyleLxiv
\begin{itemize}
\item attack time defaults to 0,
\item attack level defaults to 1.0,
\item decay time defaults to 0,
\item sustain level defaults to 1.0,
\item release start time defaults to 0,
\item release duration time defaults to 0,
\item loop from time defaults to 0,
\item loop to time defaults to 0,
\item loop limit value defaults to 0,
\item the starting position defaults to 0,
\item the sound designer{\textquotesingle}s volume level defaults to
1.0, 
\item the sound designer{\textquotesingle}s pan value defaults to
Center, and
\item the MIDI program number, MIDI note number, OSC name and function
key default to unspecified.
\end{itemize}
The result of using these defaults is that a sound effect will simply
play once at the volume of the WAV file when triggered. \ To make a
sound effect loop indefinitely, set the loop from time to the duration
of the WAV file. \ It will stop when the release process is initiated.
\ To terminate a looping sound effect automatically after a particular
length of time, set the release start time to the time the sound is
supposed to last. \ 

When the sound designer creates a sound effect, he will create the WAV
file with full volume, and use the designer{\textquotesingle}s volume
level to attenuate it so that it plays correctly if the sound effects
operator does not adjust the operator{\textquotesingle}s volume level.
\ If a sound effect must be played with different volumes at different
times, the sound designer will set the designer{\textquotesingle}s
volume level for the loudest instance, and use the velocity parameter
of the Start Sound sequence item, or the velocity of the Note On MIDI
message from an external sequencer, to attenuate other instances.

The starting position parameter is intended for rehearsals. \ The
director may wish to play the last 15 seconds of the previous song as a
lead-in to the next song. \ The rehearsal sound operator can get this
effect by editing the previous song{\textquotesingle}s parameters to
start 15 seconds before its end, when it will transition to the next
song. \ In some cases it might also be necessary to change the release
start time to 14 seconds. \ Another common situation is wishing to play
a dance number starting at a specified time.

\subsection[Internal Sequencer]{Internal Sequencer}
The internal sequencer adds additional complexity that may not be
justified, so using it is optional. \ If the internal sequencer is not
being used, the sound effects are matched to clusters based on their
MIDI program numbers and note numbers, if they are specified, or in the
order they appear in the project file, if they are not. \ Otherwise,
the internal sequencer controls how sound effects are presented to the
sound effects operator. \ 

The internal sequencer holds a list of sequence items. \ A sequence item
does one of these things:

\liststyleLxv
\begin{enumerate}
\item Start Sound: begin playing a sound effect. \ The data in the item
contains

\begin{enumerate}
\item the name of the sound effect, 
\item the velocity,
\item The sound designer{\textquotesingle}s pan value: Center, Left 1 to
100 or Right 1 to 100,
\item The program number, bank number and cluster number in which to
display this sound,
\item the name of the sequence item to execute when this sound effect
completes,
\item the name of the sequence item to execute when this sound effect is
terminated, 
\item The name of the sequence item to execute when this sound effect
starts,
\item the importance of this sound for the sound effects operator,
\item The Q\_number, which is a list of numbers separated by periods
used by MIDI Show Control, and
\item \ text to display to the operator in the cluster.
\end{enumerate}
\item Stop: cease playing a sound effect. \ The data in the item
contains

\begin{enumerate}
\item the name of the sequence item that started the sound effect, and
\item the name of the sequence item to execute next.
\end{enumerate}
\item Wait: pause this fork of the sequencer for a specified length of
time. \ The data in the item contains 

\begin{enumerate}
\item the time to wait,
\item the sequence item to execute after the specified time has passed,
and 
\item text to display to the operator while we are waiting.
\end{enumerate}
\item Offer Sound: define what one of the sound clusters does. \ The
data in the item contains

\begin{enumerate}
\item The name of the sequence item to execute when the operator pushes
the start button in the cluster, 
\item the program number (0-127), bank number (0-7) and cluster number
(0-15) of the cluster,
\item the MIDI program number and note number from an external sequencer
which causes the named sequencer item to be executed,
\item the OSC name which causes the named sequence item to be executed,
\item The Q\_number, which is a list of numbers separated by periods
used by MIDI Show Control to execute the named sequence item using the
Go command,
\item The macro number, a value from 0 to 127 which is used by MIDI Show
Control to execute the named sequence item using the Fire command,
\item The function key which causes the named sequence item to execute,
\item text to display to the operator in the cluster, and
\item the sequence item to execute next.
\end{enumerate}
\item Cease Offering Sound: remove the definition of what a cluster
does. \ The data in this item contains

\begin{enumerate}
\item The name of the Offer Sound sequence item which offered the sound,
and
\item the sequence item to execute next.
\end{enumerate}
\item Operator Wait: wait for the sound effects operator to press the
“play this sound effect” key. The operator is shown the text for this
item. \ In addition to the text there is a lamp which lights when the
internal sequencer is waiting for the operator. \ The data in this item
contains

\begin{enumerate}
\item the sequence item to execute when the operator presses his key
\item text to display to the operator, 
\item The function key which causes the sequencer to position to this
sequence item and proceed as though the operator had also pressed the
“play this sound effect” key,
\item The Q\_number, which is a list of numbers separated by periods
used by MIDI Show Control to execute this sequence item using the Go
command, and
\item The macro number, a value from 0 to 127 which is used by MIDI Show
Control to execute this sequence item using the Fire command.
\end{enumerate}
\item Start Sequence: there must be exactly one of these in a sequence.
\ The data in this item contains

\begin{enumerate}
\item The sequence item to execute next
\end{enumerate}
\end{enumerate}
The sound effects designer constructs the collection of sequencer items,
which will be presented to the sound effects operator sorted by name.
When the sequence is loaded, or in response to the Reset button or MIDI
Show Control command Reset, the Start Sequence sequencer item is
executed. \ It should set up whatever sound effects are to be offered
to the operator before the performance starts, and then execute an
Operator Wait.

If the show goes well, the sound effects operator just has to press a
key when it is time to play the next sound effect, and/or stop the last
one. \ To deal with the actors jumping around in the script, the
operator needs a dial which will rapidly scroll forward or backward.
\ The designer should include the page number in the text shown to the
operator, so he can see where he is while scrolling.

A sequence item{\textquotesingle}s name can be changed, and doing that
automatically changes all references to it elsewhere in the sequence.

To use the velocity of the Note On MIDI message from an external
sequencer, use the Offer Sound sequence item to make a Start Sound
sequence item with the velocity omitted available to the external
sequencer.

The pan value in the Start Sound sequence item, if specified, replaces
the designer{\textquotesingle}s pan value in the definition of the
sound effect.

If a Start or Offer Sound sequence item specifies a cluster on which a
sound is in its release, that sound is detached from the cluster and
the new one takes its place. \ It is an error to specify a cluster
which holds a sound that has not started its release, or one on which
there is a sound being offered (but see below for an exception to this
rule). \ If no cluster is specified, the cluster corresponding to the
sound effect{\textquotesingle}s MIDI program number and note number is
used, if it is specified and available; otherwise the lowest available
cluster is used. \ However, if the Start Sound is executed because of
the completion or termination of a previous Start Sound, this sound
will use the same cluster as the previous sound.

Note that the Start Sound sequence item can do a two-way fork, by
executing a sequence item when the sound effect starts and another when
it completes or is terminated. \ This allows multiple sound effects to
be played at the same time, and the Wait sequence item allows for a
timed delay between them. \ If a sound needs to stop based on on-stage
action, the sequencer can wait for the operator{\textquotesingle}s
signal to initiate the release of a sound effect using the Stop
sequence item. \ The sequence as a whole ends when all forks have ended
and no sounds are being played or offered.

The Offer Sound sequence item also does a two-way fork. \ It is used
when the order of sounds to be played cannot be determined in advance.
\ When a sound is offered on a cluster, the sequencer will fork when
the Start button is pressed, a MIDI message is received or an OSC
message is received. \ The volume displayed in the cluster is initially
100\%, which is the external representation of the initial operator
volume level, 1.0. \ If the operator modifies the value it is carried
over to subsequent sound effects in the same cluster until the Cease
Offering Sound sequence item for that cluster. \ This is also true for
the operator pan value, which starts at Center. \ The operator volume
level can range from 0.0 to 4.0.

An exception to the rule that a cluster occupied by an Offer Sound
cannot be used by a Start Sound applies to sounds started by triggering
an offered sound. \ Such sounds, if they do not specify a cluster, or
if they specify the same cluster as the Offer Sound, will use that
cluster, hiding the offering of the sound. \ If more than one sound
plays at the same time (not counting release), other sounds must use
different clusters. \ The offered sound becomes active again when no
sound is playing on its cluster. \ This rule permits continuity of the
operator volume and pan adjustment.

The importance number in the Start Sound sequence item controls the
display of information about the current sound. \ If this number is 0
the sound is never considered “current”; this would be used for
long-running background sounds that the sound effects operator does not
need to supervise. \ A value of 1, which is the default, causes the
sound to be regarded as the current sound when it is playing. \ In the
general controls section of the sound effects player there is a display
of the amount of time remaining in the current sound, which can be
switched to display the amount of time the current sound has been
playing. \ If there is more than one sound playing, the one with the
largest importance number, greater than 0, is considered current. \ If
more than one playing sound has the largest non-zero importance number,
one of them is chosen arbitrarily to be the current sound.

Whenever there are two or more forks in execution, there is the problem
of serializing access to the sound effects operator{\textquotesingle}s
Play button. \ If a fork executes an Operator Wait, other forks
executing Operator Wait will wait for the operator to press his Play
This Sound Effect button to complete the Operator Wait command on the
first fork. \ Forks using Operator Wait will get access to the operator
in the order they requested access. \ The Wait sequence item is lower
priority: its display is pre-empted by a subsequent Operator Wait.
\ When there is no Operator Wait in progress, the Wait that will end
soonest has its text on display. \ However, the Wait sequence item is
not delayed by its inability to display its message—it completes on
schedule even if it was unable to display its message at all.

\subsection[Telephone ring example]{Telephone ring example}
To make a telephone ring, we need two sound effects and seven items in
the internal sequencer. \ When the sound effects operator initiates the
ring the sequencer plays the ringing sound effect, which can include a
loop to conserve sample space. \ It has release start time set to 5
milliseconds less than the desired ring time, and release duration time
set to 10 milliseconds. \ If it completes without being stopped the
internal sequencer plays the ringout sound effect. \ The ringout sound
effect starts with 10 milliseconds of attack and no decay, providing a
click-free transition from ringing to ringout, and has an infinite
release duration time. \ If the ringout completes without being stopped
the internal sequencer will again play the ringing sound effect, and
continue alternating between ringing and ringout until the sound
effects operator signals that the ring is to stop.

If a stop command arrives during the ringing, the sound stops
immediately and the internal sequencer plays the ringout once, then
stops. \ If a stop command arrives during ringout the sound ends after
the ringout. \ Thus, the telephone will ring until it is stopped, and
when it is, the sound transitions in 10 milliseconds to the ringout
unless the ringout is already in progress.

Here is the sequence, in detail:

\liststyleLxvi
\begin{enumerate}
\item Operator Wait, text “telephone rings”, next is item 2.
\item Start sound ring, cluster 0, text “ring”, on start go to item 3,
completion is item 5, termination is item 7.
\item Operator Wait, text “stop telephone ring”, next is item 4.
\item Stop sequencer item 2, next is item 8, which is the Operator Wait
for the next sound effect
\item Start sound ringout, cluster 0, text “ring”, on completion go to
item 6
\item Start sound ring, cluster 0, text “ring”, on completion go to item
5, termination is item 7.
\item Start sound ringout, cluster 0, text “ring”, no next items
\end{enumerate}
The above sequence forks at item 2, with one branch proceeding to items
3, 4 and 8, and the other looping between items 5 and 6 until it is
terminated by the operator proceeding from item 3, in which case it may
execute item 7 before it stops. \ The meaning of item 4 is that
whatever sounds are playing as a result of item 2, all that are not
already doing their release are told to start their release.

If it is necessary to do other sound effects while letting the telephone
ring in the background, change item 2 to go to item 8 when the sound
starts, omit items 3 and 4, and instruct the sound effects operator to
press the Stop button on cluster 0 (marked “ring”) when the telephone
ringing is to stop. \ The sound effects designer must avoid using
cluster 0 for other sound effects until the telephone ringing is
definitely over.

If the telephone is to ring several times, the sound effects designer
might decide to devote a cluster to it for a period of time. \ In that
case he would specify an Offer Sound sequence item which plays the
ring, plays the ringout, and loops as described above. \ He would
instruct the sound effects operator to press the Start button on the
designated cluster to start the telephone ringing, and press Stop to
make it stop. \ After all the telephone rings are done, the sound
effects designer can use the Cease Offering Sound sequence item to free
up the cluster for other uses.

\subsection{External Sequencer}
An external sequencer can send Note On MIDI messages to trigger sound
effects. \ On receipt of such a message, if the internal sequencer is
running, the offered sound with matching MIDI program number and note
number is started, and runs until it ends. \ The player only accepts
MIDI messages from one channel—the channel number is set by the
operator. \ After sending Note On, the external sequencer can stop the
sound by sending Note Off for the same program number and note number.
\ The sound effects player also accepts All Notes Off and All Sound
Off, to handle emergencies. \ The Note Off velocity is not used.

Note Off finds all sound effects being played by an offered sound with
the specified program number and note number which have not yet started
release. \ It initiates the release process on all of those sound
effects. \ If there is no such sound effect, Note Off does nothing.
\ All Notes Off finds all sound effects which have not yet started
release and initiates release on them. \ If there are no such sound
effects, All Notes Off does nothing. \ All Sound Off mutes the master
output.

The external sequencer can also use OSC messages to start and stop
sounds.

If the internal sequencer is not running, the MIDI and OSC information
for each sound effect specified by the sound designer is used to match
incoming MIDI Note On and OSC messages to sound effects.

\subsubsection{MIDI Show Control}
The sound effects player also supports MIDI Show Control messages from
an external sequencer. \ It regards itself as a sound device of type
13, which means “EPROM player”. \ The device ID and group ID are set by
the sound effects operator. \ The sound effects player does not
implement time code, cue lists or cue paths. \ The internal sequencer
must be running for MIDI Show Control to work.

\paragraph{Q\_number}
Some of the sequence items have a data item called Q\_number to support
MIDI Show Control. \ This text field contains a list of numbers
separated by periods, for example, 36.7.832. \ For some purposes
sequence items containing Q\_numbers must be sorted in cue order. \ In
this sort, the numbers are considered separate keys, with priority
decreasing from left to right. \ Thus, the Q\_number values of 1.1,
1.5, 1.10 , 1.100 and 2 would sort in that order.

The first number in the Q\_number is referred to as the Parent of the
cue.

\paragraph{Commands}
The sound effects player supports the following MIDI Show Control
commands:

\liststyleLxvii
\begin{enumerate}
\item Go (01\textsubscript{16}): If no Q\_number is specified, continue
sequencer processing from the current Operator Wait as though the sound
effects operator had pressed his Play This Sound Effect key. \ If
Q\_number is specified, start the Offered Sound with the specified
Q\_number. \ If there is no sound being offered with this Q\_number,
search the sequence items for an Operator Wait with this Q\_number,
position the sequencer to it, and proceed as though the operator had
pressed his Play This Sound Effect key. \ Q\_list and Q\_path are
ignored.
\item Resume (03\textsubscript{16}): If no Q\_number is specified,
resumes all stopped sounds. \ If a Q\_number is specified, resumes only
stopped sounds which were running due to a Start Sound with that
Q\_number, leaving all others stopped.
\item Timed\_go (04\textsubscript{16}): treated as Go.
\item Stop (02\textsubscript{16}): If no Q\_number is specified, pauses
all sounds. \ If a Q\_number is specified, pauses only those sounds
running due to a Start Sound with that Q\_number, leaving all others
running. \ Q\_list and Q\_path are ignored. \ When a sound is paused,
the looper element stops counting time, stops advancing its position,
and outputs only silence (0.0) on all channels. \ The echo element in
the pipeline is not affected, so a sound may continue to echo after it
is stopped.
\item Load (05\textsubscript{16}): positions the sequencer to the
Operator Wait sequence item with the specified Q\_number.
\item Set (06\textsubscript{16}): Adjust the operator{\textquotesingle}s
volume level of a sound. \ This can refer to any offered sound, or any
sound that is playing. \ The reference to a sound is based on the
cluster in which it is offered or playing. \ This cluster number is
specified by the sound designer, either in the definition of a sound or
in the sequence item that plays or offers the sound. \ The body of the
Set message contains 12 bytes, each 00\textsubscript{16} to
7F\textsubscript{16}, interpreted as ASCII. \ The first byte specifies
whether we are controlling the volume of a specific sound or the master
volume control. \ A value of “1” means we are controlling a specific
sound, in which case the second, third and fourth bytes contain the
program number (“000” to “127”) the fifth the bank number (“0” to “7”)
and the sixth and seventh the cluster number (“00” to “15”). \ The
eighth through twelfth bytes contain the volume, formatted as a digit,
a period, and three digits. \ The internal volume level is a number
between 0.0 and 4.0, but it is displayed to the operator as a value
between 0\% and 400\%.

If the first byte is “2”, we are adjusting the master volume control.
\ Bytes two through seven must be ASCII spaces, and bytes eight through
twelve specify the setting of the master volume control, as described
above.
\item Fire (07\textsubscript{16}): Start the Offered Sound with the
specified macro number. \ If there is no sound being offered with this
macro number, search the sequence items for an Operator Wait with this
macro number, position to it, and proceed as though the operator had
pressed his Play This Sound Effect key.
\item All\_off (08\textsubscript{16}): mutes all sounds. \ This takes
place just after the sound meter, and does not affect processing; it is
equivalent to shutting down the speakers.
\item Restore (09\textsubscript{16}): unmutes all sounds, reversing a
prior All\_off.
\item Reset (0A\textsubscript{16}): Cancel all running forks, terminate
all sounds, clear all clusters, reinitialize all internal state,
position the sequencer to the Start Sequence item and start the
sequencer. \ The sequencer will proceed until it encounters an Operator
Wait sequence item. \ If there is no Start Sequence item the sequencer
is not started.
\item Go\_off (0B\textsubscript{16}): If Q\_number is specified,
initiate the release of all sounds not already releasing that were
started by a Start Sound with that Q\_number. \ If Q\_number is not
specified, initiate the release of all sound effects that are not
already releasing.
\item Go/Jam\_clock (10\textsubscript{16}): treated as Go.
\item Standby\_+ (11\textsubscript{16}): If the sequencer is in an
Operator Wait sequence item with a Q\_number, position the sequencer to
the Operator Wait sequence item with the next Q\_number, when the
Q\_numbers are sorted in cue order. \ If there is no such sequence
item, or if the sequencer is not at an Operator Wait sequence item with
a Q\_number, do nothing.
\item Standby\_- (12\textsubscript{16}): If the sequencer is in an
Operator Wait sequence item with a Q\_number, position the sequencer to
the Operator Wait sequence item with the previous Q\_number, when the
Q\_numbers are sorted in cue order. \ If there is no such sequence
item, or if the sequencer is not at an Operator Wait sequence item with
a Q\_number, do nothing.
\item \ Sequence\_+ (13\textsubscript{16}): If the sequencer is in an
Operator Wait sequence item with a Q\_number, position the sequencer to
the first Operator Wait sequence item with a Q\_number containing the
next Parent cue, when sorting by cue number. \ For example, if the
Q\_number of the current Operator Wait sequence item was 29.3.24.98.7,
and the the Q\_number values of subsequent (when sorted in cue number
order) Operator Wait sequence items were 29.3.25, 29.4, 29.7, 29.9.876,
36.7, 36.7.832, 36.8, 37 and 37.1, then position the sequencer to the
Operator Wait sequence item with Q\_number 36.7. \ If there is no such
sequence item, or if the sequencer is not at an Operator Wait sequence
item with a Q\_number, do nothing.
\item Sequence\_- (14\textsubscript{16}): If the sequencer is in an
Operator Wait sequence item with a Q\_number, position the sequencer to
the first Operator Wait sequence item with a Q\_number containing the
previous Parent cue, when sorting by cue number. \ For example, if the
Q\_number of the current Operator Wait sequence item was 37.4.72.18.5
and the Q\_number values of previous (when sorted in cue number order)
Operator Wait sequence items were 29.3.25, 29.4, 29.7, 29.9.876, 36.7,
36.7.832, 36.8, 37 and 37.1, then position the sequencer to the
Operator Wait sequence item with Q\_number 36.7. \ If there is no such
sequence item, or if the sequencer is not at an Operator Wait sequence
item with a Q\_number, do nothing.
\end{enumerate}
\subsection[Gstreamer pipeline]{Gstreamer pipeline}
The sound effects player is a gstreamer application and uses its custom
plug-in, described above, along with several standard plugins. \ To
avoid requiring a high-speed computer, the complete pipeline is
constructed when a project is loaded or a sound effect modified; it is
not changed while sound is playing to avoid glitching the sound. \ The
pipeline structure looks like this:

The application creates the following gstreamer pipeline for each sound
effect defined in the project:

\liststyleLxviii
\begin{enumerate}
\item A filesrc element which identifies the WAV file containing the
waveforms
\item a wavparse element, which converts the WAV file into up to eight
channels of raw audio
\item the custom pipeline described above, which provides the amplitude
envelope, looping, pause, and volume adjustment
\item an echo element, which has delay, intensity and feedback controls.
\ These are specified by the sound effects designer, and can be edited.
\ They default to no echo.
\item An equalization element, which has gain values for the 29 Hz, 59
Hz, 119 Hz, 237 Hz, 474 Hz, 947 Hz, 1889 Hz, 3770 Hz, 7523 Hz and 15011
Hz bands. These are specified by the sound effects designer, and can be
edited. \ They default to 0.
\item If the WAV file contains one or two channels, an audiopanorama
element, which handles panning. \ The control input to this element is
the product of the designer pan value and the operator pan value,
represented as 0.0 for center, -1.0 for full left and +1.0 for full
right. \ The output from this element is always two channels. \ If the
WAV file contains more than two channels, this element is not placed in
the pipeline, and the output of the previous element is connected
directly to the input of the next element.
\item A deinterleave element, which separates each channel of its input
into a different output stream.
\end{enumerate}
The result of this processing is a single-channel stream for each
channel of each sound effect. \ Each of these pipelines is paused until
its sound is started. \ The remainder of the gstreamer pipeline looks
like this:

\liststyleLxix
\begin{enumerate}
\item Eight Funnel elements, one for each output of the sound effects
player. \ The connection between the outputs of the sound effects
pipeline and the inputs of each funnel is specified by the sound
effects designer, and can be edited. \ The information is retained in
the project file. \ The default is that output channel 1 gets channel 1
from each sound effect, output channel 2 gets all the channel 2s, etc.
\ Note that each sound effects pipeline ends with a minimum of two
channels.
\item An Interleave element, which combines the outputs of the eight
funnel elements into a single stream with eight channels.
\item A Volume element, which implements the master volume control.
\item A Level element, which extracts level information from the stream
for display.
\item Another Volume element, which implements the mute control.
\item An ALSAsink element, which sends the stream to an output device.
\ The name of the output device is set in Preferences for the software
sound effects player; for the fancy console it is fixed to the device
that drives the eight XLR connectors.
\end{enumerate}
\subsection[Tools]{Tools}
The sound effects player has some tools for the sound effects designer
and sound rehearsal operator.

\subsubsection[Create a Cue from an m3u File]{Create a Cue from an m3u
File}
An m3u file contains a list of sound files. \ This tool provides a
convenient way to import them into the sound effects player as a single
cue. \ It does the following:

\liststyleLxx
\begin{enumerate}
\item Creates a sound effect for each sound file specified in the m3u
file. \ All of the parameters take their defaults.
\item Creates a Start Sound sequence item for each sound effect. \ Each
sequence item, except the last, plays the next when it completes. \ The
last plays the first, forming a loop. \ The text of the Start Sound
sequence item is the name of the sound file.
\item Creates an Operator Wait sequence item which will play the first
Start Sound sequence item when the operator pushes the Play button.
\ The text displayed to the operator is the name of the m3u file.
\item If there is no Start Sequence sequence item, creates one and makes
the above Operator Wait sequence item its successor.
\item Positions the sequencer to the Operator Wait sequence item created
above.
\end{enumerate}
After running the tool the operator can play the list of songs by
pressing the Play button. \ The Stop button on the cluster that is
playing the songs causes the player to skip to the next song. \ The
Reset button stops the player. 

The operator can edit the Operator Wait sequence item to be an Offer
Sound sequence item, specifying the cluster that is to play the songs.

Note that the m3u file can contain names of directories in addition to
names of sound files. \ In that case the directories are scanned for
sound files.

\subsubsection[Create a Play List from a Folder of Sound Files]{Create a
Play List from a Folder of Sound Files}
This tool provides a convenient way to turn a directory of sound files
into a list of cues, any of which can be played on demand. \ It does
the following:

\liststyleLxxi
\begin{enumerate}
\item Creates a sound effect for each sound file in the directory. \ All
of the parameters take their defaults.
\item Creates an Operator Wait sequence item and a Start Sound sequence
item for each sound effect. \ The text of both sequence items is the
name of the sound file.
\item Links each Operator Wait sequence item to its Start Sound sequence
item as its next item to execute. \ The Start Sound sequence item has
the next Operator Wait sequence item as the item to execute when the
sound completes or is terminated. If there is no next Operator Wait
sequence item, it links to the first.
\item If there is no Start Sequence sequence item, creates one and makes
the first Operator Wait sequence item its successor.
\end{enumerate}
After running the tool, the operator can scroll among the Operator Wait
sequence items for the song he wants, and press his Play button to play
it. \ If the operator ends the song early using the Stop button on the
song{\textquotesingle}s cluster, or if the song completes, the next
song on the play list appears and the sound effects player waits for
the operator to make a choice.

\subsection{Sound Effects Design Summary}
When a sound designer constructs sound effects, he creates the waveform
for each channel using a tool like Audacity. \ He also specifies the
envelope numbers and other information that control how the sound
effect is played. \ Each sound effect is represented by a text file
containing the envelope and other information, plus the name of the
file containing the waveforms. \ A waveform file can be used by more
than one sound effect. \ Sounds can be routed to up to 8 independent
output channels.

Unless the show is very simple, the sound effects designer will also
construct a collection of sequence items. \ They will walk the sound
effects operator through the show, giving him buttons to play the
appropriate sounds at the appropriate times.

\subsection{Implementations}
I imagine two implementations of the sound effects player. \ One is a
software-only implementation based on gstreamer 1.0. \ The other is a
self-contained fancy console. \ I am going to write about the fancy
console first, then consider how to approximate it using standard
computer parts.

\subsubsection{Fancy Console}
The largest section of the fancy console contains 16 clusters, arranged
in a 4 by 4 grid. \ Each cluster consists of two buttons marked Start
and Stop, each back-lit, a soft dial with click stops, a small display
near the dial, and a one-line display at the top of the cluster. \ When
the operator pushes a Start button, the appropriate sound effect is
started, and the Start button is lit. \ When the sound effect finishes
playing, the lamp goes out. \ Pressing the Start button while the lamp
is lit has no effect.

If the operator presses the Stop button while the Start
button{\textquotesingle}s lamp is lit, the Stop
button{\textquotesingle}s lamp is lit and the sample begins its
release. \ During release both buttons are lit, and when the release is
complete the Stop button goes out along with the Start button.
\ Pressing the Stop button while its lamp is lit has no effect.

The lamps and buttons work the same way if the start and stop come from
the internal or an external sequencer instead of the operator pressing
the Start and Stop buttons. \ When the internal sequencer is running it
controls the text at the top of each cluster. \ Otherwise the text is
the name of the sound effect.

When a sound effect is playing, the small display in the cluster show
the operator volume. \ It starts at 100\%, which is the external
representation of 1.0, but the sound effects operator can adjust the
volume by turning the soft dial. \ By pushing the dial as though it
were a button, it is switched to control the pan. \ The display shows
Center, L followed by a number if the pan is to the left, or R followed
by a number if the pan is to the right. \ If the WAV file being played
is stereo, this functions as a balance control. \ If the WAV file has
more than two channels, the pan function is not available.

Above the 16 clusters are the general controls. \ 

\liststyleLxxii
\begin{enumerate}
\item A bank dial to specify which of the eight banks of samples the 16
clusters refer to. \ 
\item Two program dials, one with 16 positions and the other with 8, to
specify the program number. 
\item A sequencer section with

\begin{enumerate}
\item a small text display, 
\item a dial to rapidly scroll forward and backward in the sequence, 
\item a forward and a backward single step button to position the
sequencer precisely, 
\item a large Play This Sound Effect button which lets the sequencer
proceed to its next item, and
\item a lamp that lights when the sequencer is waiting for the operator.

\end{enumerate}
\item A Pause button, which causes the clock to stop advancing in the
gstreamer looper element and forces it to output only silence. \ The
button lights when pressed, and pressing it again turns off the light
and turns off the pausing condition in the gstreamer looper element.
\item The master volume control, a soft dial with an adjacent
\ 2½{}-digit display. \ It defaults to 1.0, which is displayed as
100\%. \ All eight channels of output are multiplied by the master
volume control value before output.
\item A mute button. \ The mute button is back-lit and functions like
the pause button. \ When the sound effects player is muted the clock
keeps running but the outputs are silenced.
\item A single-channel stack of LEDs which function as a sound meter.
\ The sound meter can be set to any channel of output, and it is before
the mute button in the signal chain. \ Depending on how much room there
is on the console, we might make this eight stacks of LEDs and no
switching control, or two stacks and a four-position switch.
\item The Reset button stops all processing and initializes the device.
\ If there is a sequence defined, it is started at its Start Sequence
item.
\item A display of the amount of time remaining in the current sound.
\ It can be switched to show the amount of time the current sound has
been playing. \ When the internal sequencer is running, it specifies
which sound is current. \ Otherwise, the last sound triggered by the
operator is the current sound.
\item The Shutdown button stops all processing, waits for all file
writing to complete, and turns off power.
\end{enumerate}
When the sequencer plays a sound effect, it designates one of the
clusters as the operator control for the sound effect, and that
cluster{\textquotesingle}s Start button lights. \ If the sound effects
operator wishes to stop a sound effect he presses the
cluster{\textquotesingle}s Stop button. \ The sequencer can be placed
in edit mode, in which it does not perform sequence items but instead
allows them to be created, deleted, modified and renamed. \ Information
is shown on the display and can be manipulated using the dials and
buttons normally used to run the cues. \ Pressing the large Play This
Sound Effect button plays the current sequence item and all following
items just as it would during a performance until all forks are at an
Operator Wait item, but when all the sounds are complete the current
item returns to the item that is being edited.

The sound effects can also be edited. \ In sound effects editing mode,
the text at the top of each cluster shows the name of a sound effect.
\ Pressing a Start button chooses a sound effect for editing. \ The
operator uses the sequencer controls to scroll through the envelope and
other information provided by the sound designer. \ Each of the
parameters can be changed, but there is no provision for editing the
waveform files. \ Pressing the large Play This Sound Effect button
plays the sound effect currently being edited. \ This can be alternated
with adjusting the value dial to hear how changing the current
parameter affects the current sound effect. \ When a sound effect is
playing its Start button is lit. \ Pressing the corresponding Stop
button causes the sound effect to release. \ Sound effects can be
created and deleted.

The console has an Ethernet port so it can accept commands from an
external sequencer. \ It uses RTP-MIDI (RFC 6295) as implemented by
Apple (AppleMIDI) and by Mackie on their DL-series mixing desks. \ It
also supports the Behringer X32 producer, both MIDI and OSC. \ It
supports both IPv4 and IPv6. \ It also supports Zeroconf (RFC 3927).

The console has a USB interface which allows a thumb drive to be
connected, so sound files prepared externally can be loaded by the
tools, or using the sound effects editor.

Sound output is provided by eight XLR connectors. \ Digital output is
also a possibility, using the Ethernet connector. \ Storage of WAV
files and the other information is provided by an SD card slot,
protected by a latching cover \ The files on the SD card can be edited
in a computer, which is also the source of the WAV files. \ The files
on the SD card have the same format and organization as the software
implementation of the sound effects player, so the software
implementation can be used to develop sound effects for the fancy
console.

If the software internal to the console needs to be updated, new
software can be loaded from the SD card or from the USB interface.

To prevent an inexperienced sound effects operator from inadvertently
damaging the files, the latching cover for the SD card can include a
key lock, which prevents the SD card from being removed without the
key, and also signals to the console that the SD card is not to be
written. \ In addition, the SD card can be write locked using a switch
on the card. \ If more protection is considered necessary, there can be
a slide switch inside the SD card cover which prevents placing the
console in an editing mode.

There is a Setup button which provides access to options which do not
need to be changed during a performance. \ These include MIDI channel,
MIDI Show Control device ID, MIDI Show Control group ID, MIDI Show
Control UDP port number and the routing of each channel of each sound
effect to the eight outputs. \ Also in the setup group is a button to
format the SD card and write an empty project on it. \ A project can be
loaded from a thumb drive on the USB interface, in which case the SD
card is formatted and receives the loaded project. \ A backup copy of
the current project can be written to the thumb drive.

\subsubsection[Software simulation]{Software simulation}
Having indulged my fantasies by imagining a fancy sound effects console,
I will now be more practical and imagine how it might be implemented
using a standard computer. \ The program will be written as a gstreamer
1.0 application, so it can use the gstreamer plugin described above to
play sounds. \ 

The program has four modes: Run Sequencer, Run Non-sequencer, Edit Sound
Effects and Edit Sequence. \ In Run Sequencer mode the screen will show
a scrolling list of Operator Wait sequence items. \ When the sequencer
is waiting, the operator presses the space bar to play all the sound
effects until the next Operator Wait. \ The operator can also use the
up and down arrows, and the Page Up and Page Down keys, to scroll
through the Operator Wait sequence items, to deal with a jump in the
performance or choose songs to play from a play list.

In Run Non-sequencer mode the operator will be shown a scrolling list of
sound effects. \ He can use the up and down arrow keys, and the Page Up
and Page Down keys, to scroll among them. \ When he presses the space
bar the current sound effect plays, and when it starts to release the
next sound effect becomes the current sound effect. \ If he presses the
Backspace key, this forces the current sound effect to start its
release immediately, the same as receiving a Note Off from an external
sequencer.

In Edit Sound Effects mode the scrolling list of sound effects shares
the screen with a layout of all the parameters of the current sound
effect. \ The values can be adjusted by using the usual GUI facilities,
which includes typing new values into each parameter{\textquotesingle}s
cell. \ Pressing shift space plays the current sound effect but does
not change which sound effect is current. \ Pressing shift backspace
does a Note Off if there is a sound effect playing. \ There are
provisions for creating, deleting and renaming sound effects, but WAV
files are prepared by an external program. \ Shift combined with up
arrow, down arrow, page up and page down navigate through the list of
sound effects.

In Edit Sequence mode the scrolling list of sequence items (not just
Operator Wait sequence items) shares the screen with a layout of all of
the parameters of the current sequence item. \ The values can be
adjusted by using the usual GUI facilities, which includes typing new
values into each parameter{\textquotesingle}s cell. \ Pressing shift
space plays the current sequence item and all following items until an
Operator Wait. \ Pressing shift backspace does a Note Off if there is a
sound effect playing. \ There is provision for creating, deleting, and
renaming sequence items. \ Shift combined with up arrow, down arrow,
page up and page down navigate through the list of sequence items.
\ The items are ordered by their names, and changing the name of a
sequence item changes its position in the list, and all references to
it. \ Because every sequence item names its successor(s), changing a
sequence item{\textquotesingle}s name does not change any path through
the sequencer.

In all four modes a section of the screen shows a scrollable list of
clusters, which are complex boxes containing a volume or pan display, a
start button, a stop button, and a text label over the top. \ In Run
Non-sequencer mode and Edit Sound Effects mode each sound effect is
assigned a cluster based on its MIDI program number and note number, if
these are specified; otherwise the cluster is assigned based on the
sound effect{\textquotesingle}s order in the project file. \ A sound
effect can be started by clicking on its Start button, and stopped by
clicking on its Stop button. \ When the sound effect is playing, its
Start button is emphasized. \ When it is releasing, its Stop button is
also emphasized. \ Clicking anywhere in the cluster selects it. \ The
keypad plus and minus keys adjust the selected sound
effect{\textquotesingle}s operator volume. \ Shift combined with the
keypad plus and minus keys adjust the pan. \ In Edit Sound Effects mode
the selected sound effect has its parameters displayed in the control
section of the display, and these parameters can be edited.

In Run Sequencer mode and Edit Sequence mode, the contents of this
region is controlled by the sequencer, which can place clusters where
it wishes when it offers or plays sound effects. \ If the operator
selects a cluster it remains selected until it leaves the screen or the
operator selects another cluster. \ Adjusting the operator volume for a
cluster carries over to every sound effect played in that cluster until
the cluster leaves the screen.

When the program starts it can Open a project file containing global
information about the sound effects for a play, including the file name
for each sound effect. \ Each of these sound effect description files
contains the path to the WAV file that contains the waveforms, and the
values for the other parameters set by the sound designer for each
sound effect. \ The project file may also name the file which contains
all the information for the internal sequencer. \ All of these files
can be written using the Edit modes.

A function key can be tied to a sequence item or sound effect.
\ Pressing the function key works like receiving the MIDI Show Control
command Go.

The screen also includes a pause button, a mute button, a master volume
control, sound level meter, a Reset button and a time remaining
display. \ \ See the description of the fancy console for what these
controls and displays do.

The application accepts commands from an external sequencer. \ It uses
RTP-MIDI (RFC 6295) as implemented by Apple (AppleMIDI) and by Mackie
on their DL-series mixing desks. \ It also supports the Behringer X32
producer, both MIDI and OSC. \ It supports both IPv4 and IPv6 using the
facilities of its operating system.

Output can be directed to the computer{\textquotesingle}s native sound
output connectors, or to a USB sound module, such as the M-Audio Fast
Track Ultra 8R, which has eight balanced ¼{}-inch phono connectors for
output. \ Digital output is also possible, using the
computer{\textquotesingle}s Ethernet interface.

To prevent an inexperienced sound effects operator from inadvertently
damaging the files, they can be protected from writing by the sound
effect operator{\textquotesingle}s account using operating system
facilities.

There is an Edit Preferences function which provides access to options
which do not need to be changed during a performance. \ These include
MIDI channel, MIDI Show Control device ID, MIDI Show Control group ID,
MIDI Show Control UDP port number and the ALSA device that outputs the
sound. \ There is also provision for editing the routing between each
channel of each sound effect and the eight outputs.

If a project is being loaded and a file referenced in it cannot be
found, a requester asks the user to locate the file. \ If he is
successful in locating the file, the parts of the old and new file
paths are remembered. \ If a subsequent file cannot be found, an
attempt is made to find the file by substituting the new part of the
file path for the old. \ If the file is found, the user is not
notified. \ This provides a convenient way to reorganize the files of a
project, which might be done when moving a project from one computer to
another. \ The new locations of the files are saved when the project is
saved.

\subsection{City Street example}
Imagine a scene that takes place on a city street. \ There are low-level
environmental sounds, which are heard throughout the scene. \ In
addition, there are louder sounds which come at certain points in the
dialogue, such as a police siren or a bus stopping to load and unload
passengers. \ The volume of the background sounds will likely need to
be adjusted during the scene, but precisely when and by how much cannot
be determined in advance.

We will have a sound effect which holds 15 minutes of low-level
background sounds, looped. \ The sound effect has a 3-second attack to
full volume, 0 decay, full volume sustain, and 3 second release
duration time, which is triggered at the end of the scene.

Each of the other sounds has its own sound effect. \ The sequence would
be constructed like this:

\liststyleLxxiii
\begin{enumerate}
\item Operator Wait, text “scene starts”, next is item 2.
\item Start background sound effect, cluster 1, text “background”, when
it starts go to item 3.
\item Operator Wait, text “horn honks”, next is item 4.
\item Start horn sound, cluster 2, text “horn honking”, when it
completes or terminates go to item 5.
\item Operator Wait, text “siren”, next is item 6.
\item Start siren sound, cluster 2, text “siren”, when it completes or
terminates go to item 7.
\item Operator Wait, text “scene ends”, next is item 8.
\item Stop item 2, next is item 9, which is the Operator Wait for the
start of the next scene.
\end{enumerate}
If there also needs to be a ringing telephone, it can be included based
on the Telephone example. \ Because the background sound appears to the
operator in a fixed place on his screen, he can click on it and
thereafter adjust its volume using the numeric keypad, independent of
using the space bar to start other sound effects.

\subsection{The Passion of Dracula example}
The most complex sound effects I have done were for The Passion of
Dracula. \ It has music, wind, hounds, rats and heartbeat background
sounds, which overlap each other and the many foreground sounds, such
as thunder, various explosions and wolf howls. \ I ran the show without
a sequencer, using a Zoom R16 and a Roland SP-404SX. \ One effect the
director asked for that I could not do was slow down
Dracula{\textquotesingle}s heartbeat near the end of the show. \ The
design of this sound effects player has been motivated by a wish to be
able to play the sound effects from this show using a sequencer.

I am not going to work out the whole sequence for the show here—there
are about 120 sound cues. \ Instead I shall just sketch out how to
construct it.

The music plays continuously throughout the show, initially at volume
0.0. \ It always appears as an offered sound in cluster 0. \ At the top
of the show the sound effects operator sets its operator volume to 0
and starts it. \ When the sound effects operator wishes to bring it up,
he selects it and uses the numeric keypad keys to raise its volume, and
lower it later. \ On the fancy console he just turns its volume dial.
\ The music sound effect is looped and at full volume, with the sound
designer{\textquotesingle}s volume set so that raising the
operator{\textquotesingle}s volume to 100\% plays the music at the
loudest level needed by the show.

The wind is an offered sound in cluster 1. \ The sound effects operator
starts it when the doors open, and stops it when they close. \ The
close time cannot be predicted because an actor may forget to close the
doors on cue, and close them later when he remembers. \ The amplitude
envelope for this sound effect has an attack for the initial inrush of
air, a decay to a reasonable sustain level if the door is left open,
and a release which models closing the door.

The hounds, rats and heartbeat never sound together, so they are played
asynchronously in cluster 2 under control of the sequencer. \ The
sequencer also stops them when they are done. \ The other sound effects
do not overlap each other, so they are played synchronously by the
sequencer and presented in cluster 3.

The heartbeat is a complex sound, like the ringing of a telephone,
alternating from a beat to the time between beats. \ The first time the
sequencer signals that the sound is to stop, it transitions to a slower
rhythm. \ The second time it stops abruptly.

The pre-show music is a series of songs. \ They run asynchronously in a
loop until the sound effects operator signals that the show is about to
start, when they fade out over three seconds. \ This is done like the
telephone example, but with a sequence item for each song in the loop,
and no ringout. \ Alternatively, they can transition to a pre-show
safety announcement.

\subsection{Doing Standard Things}
There are certain things a sound effects player is expected to do. \ In
this section I will explain how this sound effects player does those
things.

\subsubsection{Basic Controls}
\liststyleLxxiv
\begin{enumerate}
\item Play a sound. \ In non-sequencer mode, all the sounds are visible,
each with a Start and Stop button, and a volume control. \ By using the
sequencer very complex sounds can be made using the same interface.
\ MIDI Note On, OSC and MIDI Show Control can be used to play sounds
remotely.
\item Stop playing a sound. \ As described above, each sound has a Stop
button. \ MIDI Note Off, OSC and MIDI Show Control can be used to stop
sounds remotely.
\item Stop All. \ \ The MIDI command All Sound Off can be used to stop
all sounds remotely. \ There are also the Pause and Mute buttons which
can be operated remotely using MIDI Show Control.
\item Fade. \ As described above, each sound has a volume control. \ The
volume of any sound can be controlled remotely using the MIDI Show
Control command Set.
\item Fade All. \ There is a master volume control, which can be
operated remotely using MIDI Show Control. \ In addition, the MIDI
command All Notes Off can be used to fade all sounds remotely.
\item Advance. \ The operator can skip to the next Operator Wait
sequence item using the sequencer controls. \ This can be done remotely
using the MIDI Show Control command Standby\_+.
\item Rewind. \ There is a local Reset button. \ This can be done
remotely using the MIDI Show Control command Reset.
\end{enumerate}
\subsubsection{Edit or Create a Cue}
\liststyleLxxv
\begin{enumerate}
\item Select the sound file. \ This is done with the File Name parameter
in Edit Sequence mode.
\item Set levels: the designer volume is a parameter of each sound
effect.
\item Set EQ: There is an equalizer for each sound effect. \ The
parameters are set by the sound designer, but can be modified by the
sound operator. \ They are saved with each sound.
\item Set Echo/Reverb: There is an echo processor for each sound effect.
\ Like the equalizer the parameters are set by the sound designer, but
can be modified by the sound operator, and are saved with each sound.
\item Set fade in/out, cross fade (levels and time). \ Fade in is done
using the attack time and level parameters. \ Fade out is done with
release start time and release duration time. \ Cross fading is done by
starting the new sound when the old one begins its release.
\item Play a sound on operator input or receipt of a command from a
remote sequencer: Any sound presented to the operator can also be
triggered using MIDI Note On, OSC and MIDI Show Control.
\item Fade an active cue remotely: On receipt of a Note Off, a sound can
fade out or transition to one with a lower volume using the Start Sound
sequencer item which forks to a new sound on termination of this one.
\ Also, the MIDI Show Control command Set can be used to change the
volume of any playing sound.
\item Pause a playing sound: The operator has a Pause button. This can
be done remotely using the MIDI Show Control command Pause.
\item Background/Independent: Background or independent cues can be
played by forking the sequencer, using Start Sound and specifying
sequence items to be executed when the sound starts and when it
completes or is terminated. \ These cues can be acted upon externally
since they have MIDI note numbers, and the Stop All and Fade All
commands control them.
\end{enumerate}
\subsection[Summary of Significant Changes]{Summary of Significant
Changes}
\subsubsection{November 11, 2014}
\liststyleLxxvi
\begin{enumerate}
\item Added the section Doing Standard Things in response to
Mac{\textquotesingle}s review of the November 10 edition. \ Adding that
pointed out the need for some additional controls and remote commands.
That led me to MIDI Show Control.
\item Added support of MIDI Show Control in addition to the usual Note
On and Note Off commands.
\end{enumerate}
\subsubsection{November 14, 2014}
Mac showed me Cueplayer, a very good sound player. \ To achieve feature
parity with it, I added the following features:

\liststyleLxxvii
\begin{enumerate}
\item Allow sound to be re-channeled into the eight outputs
\item Replace the 3-band equalizer with a 10-band equalizer.
\item Allow the sound rehearsal operator to start a sound later than its
normal start point.
\item Display the time left in the current sound
\item Let a function key start a sound
\item Add panning of monophonic and stereo sound effects.
\item Add tools to create play lists from imported sound files or m3u
files.
\item Provide a convenient way to relocate sound files.
\end{enumerate}
Also, I acknowledged the role of the rehearsal sound operator as a third
user of the sound effects player.

\subsubsection{November 15, 2014}
Make the goal of not requiring a high-speed CPU explicit, and use this
goal to justify the fixed gstreamer pipeline.

\subsubsection[December 21, 2014]{December 21, 2014}
Based on what I have learned about gstreamer, update the volume
definition to be a floating-point number between 0.0 and 4.0, and
update the time base to nanoseconds.


\bigskip
\end{document}
